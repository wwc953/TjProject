{
  "size": 0,
  "query": {
    "bool": {
      "must_not": [
        {
          "terms": {
            "operView.keyword": [
              "退出机器人",
              "连接成功",
              "连接失败",
              "关闭助理",
              "通知唤醒",
              "初始化机器人"
            ],
            "boost": 1.0
          }
        }
      ],
      "adjust_pure_negative": true,
      "boost": 1.0
    }
  },
  "aggregations": {
    "mgtorg_agg": {
      "terms": {
        "script": {
          "source": "def domain = doc['mgtOrgCode.keyword'].value; if(domain.length()<params['len']) { return domain;} else { return domain.substring(0, params['len']);}",
          "lang": "painless",
          "params": {
            "len": 5
          }
        },
        "size": 2000,
        "min_doc_count": 1,
        "shard_min_doc_count": 0,
        "show_term_doc_count_error": false,
        "order": {
          "_key": "asc"
        }
      },
      "aggregations": {
        "time_datehis": {
          "terms": {
            "script": {
              "source": "def time = doc['systemTime.keyword'].value;def beginIndex =time.indexOf(' ');def domain = time.substring(0,beginIndex);return domain",
              "lang": "painless"
            },
            "size": 2000,
            "min_doc_count": 1,
            "shard_min_doc_count": 0,
            "show_term_doc_count_error": false,
            "order": {
              "_key": "asc"
            }
          },
          "aggregations": {
            "dis_rs": {
              "cardinality": {
                "field": "handleId.keyword"
              }
            },
            "filter_yyhx": {
              "filter": {
                "terms": {
                  "operView.keyword": [
                    "点击唤醒",
                    "语音唤醒"
                  ],
                  "boost": 1.0
                }
              }
            },
            "filter_zs": {
              "filter": {
                "terms": {
                  "operView.keyword": [
                    "查询知识库",
                    "查询知识详情",
                    "知识考试",
                    "大模型数据",
                    "练习题库"
                  ],
                  "boost": 1.0
                }
              }
            },
            "count_zl": {
              "filter": {
                "bool": {
                  "must_not": [
                    {
                      "terms": {
                        "operView.keyword": [
                          "退出机器人",
                          "连接成功",
                          "连接失败",
                          "关闭助理",
                          "通知唤醒",
                          "初始化机器人",
                          "点击唤醒",
                          "语音唤醒"
                        ],
                        "boost": 1.0
                      }
                    }
                  ],
                  "adjust_pure_negative": true,
                  "boost": 1.0
                }
              }
            }
          }
        }
      }
    }
  }
}
